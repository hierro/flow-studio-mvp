import{c as E,g as At}from"./index-Bj-4VdpB.js";function Ot(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var je={},Z={},ne={},ye={};(function(n){var e=E&&E.__awaiter||function(i,s,o,a){function u(l){return l instanceof o?l:new o(function(c){c(l)})}return new(o||(o=Promise))(function(l,c){function h(m){try{d(a.next(m))}catch(g){c(g)}}function f(m){try{d(a.throw(m))}catch(g){c(g)}}function d(m){m.done?l(m.value):u(m.value).then(h,f)}d((a=a.apply(i,s||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.TARGET_URL_HEADER=void 0,n.withMiddleware=t,n.withProxy=r;function t(...i){const s=o=>typeof o=="function";return o=>e(this,void 0,void 0,function*(){let a=Object.assign({},o);for(const u of i.filter(s))a=yield u(a);return a})}n.TARGET_URL_HEADER="x-fal-target-url";function r(i){const s=o=>Promise.resolve(o);return typeof window>"u"?s:o=>o.headers&&n.TARGET_URL_HEADER in o?s(o):Promise.resolve(Object.assign(Object.assign({},o),{url:i.targetUrl,headers:Object.assign(Object.assign({},o.headers||{}),{[n.TARGET_URL_HEADER]:o.url})}))}})(ye);var A={},Ge=E&&E.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(h){o(h)}}function u(c){try{l(r.throw(c))}catch(h){o(h)}}function l(c){c.done?s(c.value):i(c.value).then(a,u)}l((r=r.apply(n,e||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});A.ValidationError=A.ApiError=void 0;A.defaultResponseHandler=qe;A.resultResponseHandler=Tt;const Ut="x-fal-request-id";class ee extends Error{constructor({message:e,status:t,body:r}){super(e),this.name="ApiError",this.status=t,this.body=r}}A.ApiError=ee;class He extends ee{constructor(e){super(e),this.name="ValidationError"}get fieldErrors(){return typeof this.body.detail=="string"?[{loc:["body"],msg:this.body.detail,type:"value_error"}]:this.body.detail||[]}getFieldErrors(e){return this.fieldErrors.filter(t=>t.loc[t.loc.length-1]===e)}}A.ValidationError=He;function qe(n){return Ge(this,void 0,void 0,function*(){var e;const{status:t,statusText:r}=n,i=(e=n.headers.get("Content-Type"))!==null&&e!==void 0?e:"";if(!n.ok){if(i.includes("application/json")){const s=yield n.json(),o=t===422?He:ee;throw new o({message:s.message||r,status:t,body:s})}throw new ee({message:`HTTP ${t}: ${r}`,status:t})}return i.includes("application/json")?n.json():i.includes("text/html")?n.text():i.includes("application/octet-stream")?n.arrayBuffer():n.text()})}function Tt(n){return Ge(this,void 0,void 0,function*(){return{data:yield qe(n),requestId:n.headers.get(Ut)||""}})}var K={},x={},Pt=E&&E.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(h){o(h)}}function u(c){try{l(r.throw(c))}catch(h){o(h)}}function l(c){c.done?s(c.value):i(c.value).then(a,u)}l((r=r.apply(n,e||[])).next())})};Object.defineProperty(x,"__esModule",{value:!0});x.ensureEndpointIdFormat=Ve;x.parseEndpointId=It;x.isValidUrl=Rt;x.throttle=Dt;x.isReact=Mt;x.isPlainObject=Ft;x.sleep=Lt;function Ve(n){if(n.split("/").length>1)return n;const[,t,r]=/^([0-9]+)-([a-zA-Z0-9-]+)$/.exec(n)||[];if(t&&r)return`${t}/${r}`;throw new Error(`Invalid app id: ${n}. Must be in the format <appOwner>/<appId>`)}const vt=["workflows","comfy"];function It(n){const t=Ve(n).split("/");return vt.includes(t[0])?{owner:t[1],alias:t[2],path:t.slice(3).join("/")||void 0,namespace:t[0]}:{owner:t[0],alias:t[1],path:t.slice(2).join("/")||void 0}}function Rt(n){try{const{host:e}=new URL(n);return/(fal\.(ai|run))$/.test(e)}catch{return!1}}function Dt(n,e,t=!1){let r,i;return(...s)=>{!i&&t?(n(...s),i=Date.now()):(r&&clearTimeout(r),r=setTimeout(()=>{Date.now()-i>=e&&(n(...s),i=Date.now())},e-(Date.now()-i)))}}let ce;function Mt(){if(ce===void 0){const n=new Error().stack;ce=!!n&&(n.includes("node_modules/react-dom/")||n.includes("node_modules/next/"))}return ce}function Ft(n){return!!n&&Object.getPrototypeOf(n)===Object.prototype}function Lt(n){return Pt(this,void 0,void 0,function*(){return new Promise(e=>setTimeout(e,n))})}(function(n){var e=E&&E.__awaiter||function(a,u,l,c){function h(f){return f instanceof l?f:new l(function(d){d(f)})}return new(l||(l=Promise))(function(f,d){function m(p){try{_(c.next(p))}catch(w){d(w)}}function g(p){try{_(c.throw(p))}catch(w){d(w)}}function _(p){p.done?f(p.value):h(p.value).then(m,g)}_((c=c.apply(a,u||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.DEFAULT_RETRY_OPTIONS=n.DEFAULT_RETRYABLE_STATUS_CODES=void 0,n.isRetryableError=i,n.calculateBackoffDelay=s,n.executeWithRetry=o;const t=A,r=x;n.DEFAULT_RETRYABLE_STATUS_CODES=[429,502,503,504],n.DEFAULT_RETRY_OPTIONS={maxRetries:3,baseDelay:1e3,maxDelay:3e4,backoffMultiplier:2,retryableStatusCodes:n.DEFAULT_RETRYABLE_STATUS_CODES,enableJitter:!0};function i(a,u){return a instanceof t.ApiError&&u.includes(a.status)}function s(a,u,l,c,h){const f=Math.min(u*Math.pow(c,a),l);if(h){const d=.25*f*(Math.random()*2-1);return Math.max(0,f+d)}return f}function o(a,u,l){return e(this,void 0,void 0,function*(){const c={totalAttempts:0,totalDelay:0};let h;for(let f=0;f<=u.maxRetries;f++){c.totalAttempts++;try{return{result:yield a(),metrics:c}}catch(d){if(h=d,c.lastError=d,f===u.maxRetries||!i(d,u.retryableStatusCodes))throw d;const m=s(f,u.baseDelay,u.maxDelay,u.backoffMultiplier,u.enableJitter);c.totalDelay+=m,l&&l(f+1,d,m),yield(0,r.sleep)(m)}}throw h})}})(K);var k={};const Nt="@fal-ai/client",Bt="1.6.1",kt={name:Nt,version:Bt};Object.defineProperty(k,"__esModule",{value:!0});k.isBrowser=$t;k.getUserAgent=zt;function $t(){return typeof window<"u"&&typeof window.document<"u"}let Y=null;function zt(){if(Y!==null)return Y;const n=kt;return Y=`${n.name}/${n.version}`,Y}(function(n){var e={ACLOCAL_PATH:"C:\\Program Files\\Git\\mingw64\\share\\aclocal;C:\\Program Files\\Git\\usr\\share\\aclocal",ALLUSERSPROFILE:"C:\\ProgramData",APPDATA:"C:\\Users\\Azorius\\AppData\\Roaming",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\crashpad_17844_WDWYPRCAQADCZJDZ",CLAUDECODE:"1",CLAUDE_CODE_ENTRYPOINT:"cli",CLAUDE_CODE_SSE_PORT:"60393",COLOR:"0",COLORTERM:"truecolor",COMMONPROGRAMFILES:"C:\\Program Files\\Common Files",COMPLUS_MDA:"0",COMPUTERNAME:"NOTEBOOK",COMSPEC:"C:\\Program Files\\Git\\bin\\bash.exe",CONFIG_SITE:"C:/Program Files/Git/etc/config.site",COREPACK_ENABLE_AUTO_PIN:"0",ChocolateyInstall:"C:\\ProgramData\\chocolatey",ChocolateyLastPathUpdate:"133958258709051074","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",DISPLAY:"needs-to-be-defined",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\WINDOWS\\notepad.exe",EFC_20252_1262719628:"1",EFC_20252_1592913036:"1",EFC_20252_2283032206:"1",EFC_20252_2775293581:"1",EFC_20252_3789132940:"1",ENABLE_IDE_INTEGRATION:"true",EXEPATH:"C:\\Program Files\\Git\\bin",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\Azorius\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass.sh",GIT_EDITOR:"true",GPU_FORCE_64BIT_PTR:"0",GPU_MAX_ALLOC_PERCENT:"100",GPU_MAX_HEAP_SIZE:"100",GPU_SINGLE_ALLOC_PERCENT:"100",GPU_USE_SYNC_OBJECTS:"1",HOME:"C:\\Users\\Azorius",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\Azorius",HOSTNAME:"NOTEBOOK",INFOPATH:"C:\\Program Files\\Git\\usr\\local\\info;C:\\Program Files\\Git\\usr\\share\\info;C:\\Program Files\\Git\\usr\\info;C:\\Program Files\\Git\\share\\info",INIT_CWD:"C:\\_REPO_\\flow-studio-mvp",INTEL_DEV_REDIST:"C:\\Program Files (x86)\\Common Files\\Intel\\Shared Libraries\\",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\Azorius\\AppData\\Local",LOGONSERVER:"\\\\NOTEBOOK",MANPATH:"C:\\Program Files\\Git\\mingw64\\local\\man;C:\\Program Files\\Git\\mingw64\\share\\man;C:\\Program Files\\Git\\usr\\local\\man;C:\\Program Files\\Git\\usr\\share\\man;C:\\Program Files\\Git\\usr\\man;C:\\Program Files\\Git\\share\\man",MINGW_CHOST:"x86_64-w64-mingw32",MINGW_PACKAGE_PREFIX:"mingw-w64-x86_64",MINGW_PREFIX:"C:/Program Files/Git/mingw64",MSYSTEM:"MINGW64",MSYSTEM_CARCH:"x86_64",MSYSTEM_CHOST:"x86_64-w64-mingw32",MSYSTEM_PREFIX:"C:/Program Files/Git/mingw64",NODE:"C:\\Program Files\\nodejs\\node.exe",NODE_ENV:"production",NUMBER_OF_PROCESSORS:"8",OLDPWD:"C:/_REPO_/flow-studio-mvp",OPENAI_API_KEY:"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",ORIGINAL_PATH:"C:\\Program Files\\Git\\mingw64\\bin;C:\\Program Files\\Git\\usr\\bin;C:\\Users\\Azorius\\bin;C:\\Python313\\Scripts;C:\\Python313;C:\\Program Files (x86)\\Common Files\\Intel\\Shared Libraries\\redist\\intel64_win\\compiler;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0;C:\\WINDOWS\\System32\\OpenSSH;C:\\Program Files\\Git\\cmd;C:\\Program Files\\dotnet;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0;C:\\WINDOWS\\System32\\OpenSSH;C:\\Program Files\\TortoiseGit\\bin;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\Program Files\\nodejs;C:\\ProgramData\\chocolatey\\bin;C:\\Users\\Azorius\\AppData\\Local\\Programs\\Python\\Python312;C:\\Users\\Azorius\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\Azorius\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\Azorius\\AppData\\Roaming\\npm;C:\\Users\\Azorius\\AppData\\Roaming\\Code\\User\\globalStorage\\github.copilot-chat\\debugCommand",ORIGINAL_TEMP:"C:/Users/Azorius/AppData/Local/Temp",ORIGINAL_TMP:"C:/Users/Azorius/AppData/Local/Temp",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"delta",OneDrive:"C:\\Users\\Azorius\\OneDrive",PATH:"C:\\Program Files\\Git\\mingw64\\bin;C:\\Program Files\\Git\\usr\\bin;C:\\Users\\Azorius\\bin;C:\\_REPO_\\flow-studio-mvp\\node_modules\\.bin;C:\\_REPO_\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Users\\Azorius\\bin;C:\\Program Files\\Git\\mingw64\\bin;C:\\Program Files\\Git\\usr\\local\\bin;C:\\Program Files\\Git\\usr\\bin;C:\\Program Files\\Git\\usr\\bin;C:\\Program Files\\Git\\mingw64\\bin;C:\\Program Files\\Git\\usr\\bin;C:\\Users\\Azorius\\bin;C:\\Python313\\Scripts;C:\\Python313;C:\\Program Files (x86)\\Common Files\\Intel\\Shared Libraries\\redist\\intel64_win\\compiler;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0;C:\\WINDOWS\\System32\\OpenSSH;C:\\Program Files\\Git\\cmd;C:\\Program Files\\dotnet;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0;C:\\WINDOWS\\System32\\OpenSSH;C:\\Program Files\\TortoiseGit\\bin;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\Program Files\\nodejs;C:\\ProgramData\\chocolatey\\bin;C:\\Users\\Azorius\\AppData\\Local\\Programs\\Python\\Python312;C:\\Users\\Azorius\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\Azorius\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\Azorius\\AppData\\Roaming\\npm;C:\\Users\\Azorius\\AppData\\Roaming\\Code\\User\\globalStorage\\github.copilot-chat\\debugCommand;C:\\Program Files\\Git\\usr\\bin\\vendor_perl;C:\\Program Files\\Git\\usr\\bin\\core_perl",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.PY;.PYW;.CPL",PKG_CONFIG_PATH:"C:\\Program Files\\Git\\mingw64\\lib\\pkgconfig;C:\\Program Files\\Git\\mingw64\\share\\pkgconfig",PLINK_PROTOCOL:"ssh",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"AMD64 Family 23 Model 24 Stepping 1, AuthenticAMD",PROCESSOR_LEVEL:"23",PROCESSOR_REVISION:"1801",PROGRAMFILES:"C:\\Program Files",PSModulePath:"C:\\Users\\Azorius\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",PWD:"C:/_REPO_/flow-studio-mvp",ProgramData:"C:\\ProgramData","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",SESSIONNAME:"Console",SHELL:"C:\\Program Files\\Git\\usr\\bin\\bash.exe",SHLVL:"3",SSH_ASKPASS:"C:/Program Files/Git/mingw64/bin/git-askpass.exe",SYSTEMDRIVE:"C:",SYSTEMROOT:"C:\\WINDOWS",TEMP:"C:\\Users\\Azorius\\AppData\\Local\\Temp",TERM:"xterm-256color",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.102.2",TMP:"C:\\Users\\Azorius\\AppData\\Local\\Temp",TMPDIR:"C:\\Users\\Azorius\\AppData\\Local\\Temp",USERDOMAIN:"NOTEBOOK",USERDOMAIN_ROAMINGPROFILE:"NOTEBOOK",USERNAME:"Azorius",USERPROFILE:"C:\\Users\\Azorius",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\Azorius\\AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\Azorius\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-e2a92a45bd-sock",VSCODE_INJECTION:"1",WINDIR:"C:\\WINDOWS",__PSLockDownPolicy:"0",npm_command:"run-script",npm_config_cache:"C:\\Users\\Azorius\\AppData\\Local\\npm-cache",npm_config_global_prefix:"C:\\Users\\Azorius\\AppData\\Roaming\\npm",npm_config_globalconfig:"C:\\Users\\Azorius\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_init_module:"C:\\Users\\Azorius\\.npm-init.js",npm_config_local_prefix:"C:\\_REPO_\\flow-studio-mvp",npm_config_node_gyp:"C:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_npm_version:"10.9.2",npm_config_prefix:"C:\\Users\\Azorius\\AppData\\Roaming\\npm",npm_config_user_agent:"npm/10.9.2 node/v22.17.0 win32 x64 workspaces/false",npm_config_userconfig:"C:\\Users\\Azorius\\.npmrc",npm_execpath:"C:\\Program Files\\nodejs\\node_modules\\npm\\bin\\npm-cli.js",npm_lifecycle_event:"build",npm_lifecycle_script:"vite build",npm_node_execpath:"C:\\Program Files\\nodejs\\node.exe",npm_package_json:"C:\\_REPO_\\flow-studio-mvp\\package.json",npm_package_name:"flow-studio-mvp",npm_package_version:"0.1.0"};Object.defineProperty(n,"__esModule",{value:!0}),n.credentialsFromEnv=void 0,n.resolveDefaultFetch=o,n.createConfig=c,n.getRestApiUrl=h;const t=ye,r=A,i=K,s=k;function o(){if(typeof fetch>"u")throw new Error("Your environment does not support fetch. Please provide your own fetch implementation.");return fetch}function a(){return typeof process<"u"&&e&&(typeof e.FAL_KEY<"u"||typeof e.FAL_KEY_ID<"u"&&typeof e.FAL_KEY_SECRET<"u")}const u=()=>{if(a())return typeof e.FAL_KEY<"u"?e.FAL_KEY:e.FAL_KEY_ID?`${e.FAL_KEY_ID}:${e.FAL_KEY_SECRET}`:void 0};n.credentialsFromEnv=u;const l={credentials:n.credentialsFromEnv,suppressLocalCredentialsWarning:!1,requestMiddleware:f=>Promise.resolve(f),responseHandler:r.defaultResponseHandler,retry:i.DEFAULT_RETRY_OPTIONS};function c(f){var d;let m=Object.assign(Object.assign(Object.assign({},l),f),{fetch:(d=f.fetch)!==null&&d!==void 0?d:o(),retry:Object.assign(Object.assign({},i.DEFAULT_RETRY_OPTIONS),f.retry||{})});f.proxyUrl&&(m=Object.assign(Object.assign({},m),{requestMiddleware:(0,t.withMiddleware)(m.requestMiddleware,(0,t.withProxy)({targetUrl:f.proxyUrl}))}));const{credentials:g,suppressLocalCredentialsWarning:_}=m,p=typeof g=="function"?g():g;return(0,s.isBrowser)()&&p&&!_&&console.warn("The fal credentials are exposed in the browser's environment. That's not recommended for production use cases."),m}function h(){return"https://rest.alpha.fal.ai"}})(ne);var re={},R={},Te=E&&E.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(h){o(h)}}function u(c){try{l(r.throw(c))}catch(h){o(h)}}function l(c){c.done?s(c.value):i(c.value).then(a,u)}l((r=r.apply(n,e||[])).next())})},Wt=E&&E.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};Object.defineProperty(R,"__esModule",{value:!0});R.dispatchRequest=Gt;R.buildUrl=Ht;const Pe=K,ve=k,me=x,jt=typeof navigator<"u"&&(navigator==null?void 0:navigator.userAgent)==="Cloudflare-Workers";function Gt(n){return Te(this,void 0,void 0,function*(){var e;const{targetUrl:t,input:r,config:i,options:s={}}=n,{credentials:o,requestMiddleware:a,responseHandler:u,fetch:l}=i,c=Object.assign(Object.assign({},i.retry),s.retry||{}),h=()=>Te(this,void 0,void 0,function*(){var d,m,g;const _=(0,ve.isBrowser)()?{}:{"User-Agent":(0,ve.getUserAgent)()},p=typeof o=="function"?o():o,{method:w,url:O,headers:S}=yield a({method:((m=(d=n.method)!==null&&d!==void 0?d:s.method)!==null&&m!==void 0?m:"post").toUpperCase(),url:t,headers:n.headers}),U=p?{Authorization:`Key ${p}`}:{},oe=Object.assign(Object.assign(Object.assign(Object.assign({},U),{Accept:"application/json","Content-Type":"application/json"}),_),S??{}),{responseHandler:ae,retry:vr}=s,Ue=Wt(s,["responseHandler","retry"]),Ct=yield l(O,Object.assign(Object.assign(Object.assign(Object.assign({},Ue),{method:w,headers:Object.assign(Object.assign({},oe),(g=Ue.headers)!==null&&g!==void 0?g:{})}),!jt&&{mode:"cors"}),{signal:s.signal,body:w.toLowerCase()!=="get"&&r?JSON.stringify(r):void 0}));return yield(ae??u)(Ct)});let f;for(let d=0;d<=c.maxRetries;d++)try{return yield h()}catch(m){if(f=m,d===c.maxRetries||!(0,Pe.isRetryableError)(m,c.retryableStatusCodes)||((e=s.signal)===null||e===void 0?void 0:e.aborted))throw m;const _=(0,Pe.calculateBackoffDelay)(d,c.baseDelay,c.maxDelay,c.backoffMultiplier,c.enableJitter);yield(0,me.sleep)(_)}throw f})}function Ht(n,e={}){var t,r;const i=((t=e.method)!==null&&t!==void 0?t:"post").toLowerCase(),s=((r=e.path)!==null&&r!==void 0?r:"").replace(/^\//,"").replace(/\/{2,}/,"/"),o=e.input,a=Object.assign(Object.assign({},e.query||{}),i==="get"?o:{}),u=Object.keys(a).length>0?`?${new URLSearchParams(a).toString()}`:"";if((0,me.isValidUrl)(n))return`${n.endsWith("/")?n:`${n}/`}${s}${u}`;const l=(0,me.ensureEndpointIdFormat)(n);return`${`https://${e.subdomain?`${e.subdomain}.`:""}fal.run/${l}/${s}`.replace(/\/$/,"")}${u}`}var $={},_e={};Object.defineProperty(_e,"__esModule",{value:!0});function qt(n){let e,t,r,i,s,o,a;return u(),{feed:l,reset:u};function u(){e=!0,t="",r=0,i=-1,s=void 0,o=void 0,a=""}function l(h){t=t?t+h:h,e&&Vt(t)&&(t=t.slice(Ke.length)),e=!1;const f=t.length;let d=0,m=!1;for(;d<f;){m&&(t[d]===`
`&&++d,m=!1);let g=-1,_=i,p;for(let w=r;g<0&&w<f;++w)p=t[w],p===":"&&_<0?_=w-d:p==="\r"?(m=!0,g=w-d):p===`
`&&(g=w-d);if(g<0){r=f-d,i=_;break}else r=0,i=-1;c(t,d,_,g),d+=g+1}d===f?t="":d>0&&(t=t.slice(d))}function c(h,f,d,m){if(m===0){a.length>0&&(n({type:"event",id:s,event:o||void 0,data:a.slice(0,-1)}),a="",s=void 0),o=void 0;return}const g=d<0,_=h.slice(f,f+(g?m:d));let p=0;g?p=m:h[f+d+1]===" "?p=d+2:p=d+1;const w=f+p,O=m-p,S=h.slice(w,w+O).toString();if(_==="data")a+=S?"".concat(S,`
`):`
`;else if(_==="event")o=S;else if(_==="id"&&!S.includes("\0"))s=S;else if(_==="retry"){const U=parseInt(S,10);Number.isNaN(U)||n({type:"reconnect-interval",value:U})}}}const Ke=[239,187,191];function Vt(n){return Ke.every((e,t)=>n.charCodeAt(t)===e)}_e.createParser=qt;var we={};(function(n){var e=E&&E.__awaiter||function(o,a,u,l){function c(h){return h instanceof u?h:new u(function(f){f(h)})}return new(u||(u=Promise))(function(h,f){function d(_){try{g(l.next(_))}catch(p){f(p)}}function m(_){try{g(l.throw(_))}catch(p){f(p)}}function g(_){_.done?h(_.value):c(_.value).then(d,m)}g((l=l.apply(o,a||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.TOKEN_EXPIRATION_SECONDS=void 0,n.getTemporaryAuthToken=s;const t=ne,r=R,i=x;n.TOKEN_EXPIRATION_SECONDS=120;function s(o,a){return e(this,void 0,void 0,function*(){const u=(0,i.parseEndpointId)(o),l=yield(0,r.dispatchRequest)({method:"POST",targetUrl:`${(0,t.getRestApiUrl)()}/tokens/`,config:a,input:{allowed_apps:[u.alias],token_expiration:n.TOKEN_EXPIRATION_SECONDS}});return typeof l!="string"&&l.detail?l.detail:l})}})(we);var B=E&&E.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(h){o(h)}}function u(c){try{l(r.throw(c))}catch(h){o(h)}}function l(c){c.done?s(c.value):i(c.value).then(a,u)}l((r=r.apply(n,e||[])).next())})},q=E&&E.__await||function(n){return this instanceof q?(this.v=n,this):new q(n)},Kt=E&&E.__asyncGenerator||function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(d){return function(m){return Promise.resolve(m).then(d,h)}}function a(d,m){r[d]&&(i[d]=function(g){return new Promise(function(_,p){s.push([d,g,_,p])>1||u(d,g)})},m&&(i[d]=m(i[d])))}function u(d,m){try{l(r[d](m))}catch(g){f(s[0][3],g)}}function l(d){d.value instanceof q?Promise.resolve(d.value.v).then(c,h):f(s[0][2],d)}function c(d){u("next",d)}function h(d){u("throw",d)}function f(d,m){d(m),s.shift(),s.length&&u(s[0][0],s[0][1])}};Object.defineProperty($,"__esModule",{value:!0});$.FalStream=void 0;$.createStreamingClient=Jt;const Yt=_e,Xt=we,Ie=R,N=A,le="text/event-stream",Qt=15*1e3;class Ye{constructor(e,t,r){var i;this.listeners=new Map,this.buffer=[],this.currentData=void 0,this.lastEventTimestamp=0,this.streamClosed=!1,this._requestId=null,this.abortController=new AbortController,this.start=()=>B(this,void 0,void 0,function*(){var s,o;const{endpointId:a,options:u}=this,{input:l,method:c="post",connectionMode:h="server"}=u;try{if(h==="client"){const f=yield(0,Xt.getTemporaryAuthToken)(a,this.config),{fetch:d}=this.config,m=new URL(this.url);m.searchParams.set("fal_jwt_token",f);const g=yield d(m.toString(),{method:c.toUpperCase(),headers:{accept:(s=u.accept)!==null&&s!==void 0?s:le,"content-type":"application/json"},body:l&&c!=="get"?JSON.stringify(l):void 0,signal:this.abortController.signal});return this._requestId=g.headers.get("x-fal-request-id"),yield this.handleResponse(g)}return yield(0,Ie.dispatchRequest)({method:c.toUpperCase(),targetUrl:this.url,input:l,config:this.config,options:{headers:{accept:(o=u.accept)!==null&&o!==void 0?o:le},responseHandler:f=>B(this,void 0,void 0,function*(){return this._requestId=f.headers.get("x-fal-request-id"),yield this.handleResponse(f)}),signal:this.abortController.signal}})}catch(f){this.handleError(f)}}),this.handleResponse=s=>B(this,void 0,void 0,function*(){var o,a;if(!s.ok){try{yield(0,N.defaultResponseHandler)(s)}catch(g){this.emit("error",g)}return}const u=s.body;if(!u){this.emit("error",new N.ApiError({message:"Response body is empty.",status:400,body:void 0}));return}if(!((o=s.headers.get("content-type"))!==null&&o!==void 0?o:"").startsWith(le)){const g=u.getReader(),_=()=>{g.read().then(({done:p,value:w})=>{if(p){this.emit("done",this.currentData);return}this.currentData=w,this.emit("data",w),_()})};_();return}const c=new TextDecoder("utf-8"),h=s.body.getReader(),f=(0,Yt.createParser)(g=>{if(g.type==="event"){const _=g.data;try{const p=JSON.parse(_);this.buffer.push(p),this.currentData=p,this.emit("data",p),this.emit("message",p)}catch(p){this.emit("error",p)}}}),d=(a=this.options.timeout)!==null&&a!==void 0?a:Qt,m=()=>B(this,void 0,void 0,function*(){const{value:g,done:_}=yield h.read();this.lastEventTimestamp=Date.now(),f.feed(c.decode(g)),Date.now()-this.lastEventTimestamp>d&&this.emit("error",new N.ApiError({message:`Event stream timed out after ${(d/1e3).toFixed(0)} seconds with no messages.`,status:408})),_?this.emit("done",this.currentData):m().catch(this.handleError)});m().catch(this.handleError)}),this.handleError=s=>{var o;if(s.name==="AbortError"||this.signal.aborted)return;const a=s instanceof N.ApiError?s:new N.ApiError({message:(o=s.message)!==null&&o!==void 0?o:"An unknown error occurred",status:500});this.emit("error",a)},this.on=(s,o)=>{var a;this.listeners.has(s)||this.listeners.set(s,[]),(a=this.listeners.get(s))===null||a===void 0||a.push(o)},this.emit=(s,o)=>{const a=this.listeners.get(s)||[];for(const u of a)u(o)},this.done=()=>B(this,void 0,void 0,function*(){return this.donePromise}),this.abort=s=>{this.streamClosed||this.abortController.abort(s)},this.endpointId=e,this.config=t,this.url=(i=r.url)!==null&&i!==void 0?i:(0,Ie.buildUrl)(e,{path:"/stream",query:r.queryParams}),this.options=r,this.donePromise=new Promise((s,o)=>{this.streamClosed&&o(new N.ApiError({message:"Streaming connection is already closed.",status:400,body:void 0})),this.signal.addEventListener("abort",()=>{var a;s((a=this.currentData)!==null&&a!==void 0?a:{})}),this.on("done",a=>{this.streamClosed=!0,s(a)}),this.on("error",a=>{this.streamClosed=!0,o(a)})}),r.signal&&r.signal.addEventListener("abort",()=>{this.abortController.abort()}),this.start().catch(this.handleError)}[Symbol.asyncIterator](){return Kt(this,arguments,function*(){let t=!0;const r=()=>t=!1;for(this.on("error",r),this.on("done",r);t||this.buffer.length>0;){const i=this.buffer.shift();i&&(yield yield q(i)),yield q(new Promise(s=>setTimeout(s,16)))}})}get signal(){return this.abortController.signal}get requestId(){return this._requestId}}$.FalStream=Ye;function Jt({config:n,storage:e}){return{stream(t,r){return B(this,void 0,void 0,function*(){const i=r.input?yield e.transformInput(r.input):void 0;return new Ye(t,n,Object.assign(Object.assign({},r),{input:i}))})}}}var M=E&&E.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(h){o(h)}}function u(c){try{l(r.throw(c))}catch(h){o(h)}}function l(c){c.done?s(c.value):i(c.value).then(a,u)}l((r=r.apply(n,e||[])).next())})},Zt=E&&E.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};Object.defineProperty(re,"__esModule",{value:!0});re.createQueueClient=void 0;const P=R,en=A,Xe=K,tn=$,X=x,Re=500,De={maxRetries:3,baseDelay:1e3,maxDelay:6e4,retryableStatusCodes:Xe.DEFAULT_RETRYABLE_STATUS_CODES},nn={maxRetries:5,baseDelay:1e3,maxDelay:3e4,retryableStatusCodes:[...Xe.DEFAULT_RETRYABLE_STATUS_CODES,500]},rn=({config:n,storage:e})=>{const t={submit(r,i){return M(this,void 0,void 0,function*(){const{webhookUrl:s,priority:o,hint:a}=i,u=Zt(i,["webhookUrl","priority","hint"]),l=i.input?yield e.transformInput(i.input):void 0;return(0,P.dispatchRequest)({method:i.method,targetUrl:(0,P.buildUrl)(r,Object.assign(Object.assign({},u),{subdomain:"queue",query:s?{fal_webhook:s}:void 0})),headers:Object.assign({"x-fal-queue-priority":o??"normal"},a&&{"x-fal-runner-hint":a}),input:l,config:n,options:{signal:i.abortSignal,retry:De}})})},status(r,i){return M(this,arguments,void 0,function*(s,{requestId:o,logs:a=!1,abortSignal:u}){const l=(0,X.parseEndpointId)(s),c=l.namespace?`${l.namespace}/`:"";return(0,P.dispatchRequest)({method:"get",targetUrl:(0,P.buildUrl)(`${c}${l.owner}/${l.alias}`,{subdomain:"queue",query:{logs:a?"1":"0"},path:`/requests/${o}/status`}),config:n,options:{signal:u,retry:nn}})})},streamStatus(r,i){return M(this,arguments,void 0,function*(s,{requestId:o,logs:a=!1,connectionMode:u}){const l=(0,X.parseEndpointId)(s),c=l.namespace?`${l.namespace}/`:"",h={logs:a?"1":"0"},f=(0,P.buildUrl)(`${c}${l.owner}/${l.alias}`,{subdomain:"queue",path:`/requests/${o}/status/stream`,query:h});return new tn.FalStream(s,n,{url:f,method:"get",connectionMode:u,queryParams:h})})},subscribeToStatus(r,i){return M(this,void 0,void 0,function*(){const s=i.requestId,o=i.timeout;let a;const u=()=>{};if(i.mode==="streaming"){const l=yield t.streamStatus(r,{requestId:s,logs:i.logs,connectionMode:"connectionMode"in i?i.connectionMode:void 0}),c=[];o&&(a=setTimeout(()=>{throw l.abort(),t.cancel(r,{requestId:s}).catch(u),new Error(`Client timed out waiting for the request to complete after ${o}ms`)},o)),l.on("data",f=>{i.onQueueUpdate&&("logs"in f&&Array.isArray(f.logs)&&f.logs.length>0&&c.push(...f.logs),i.onQueueUpdate("logs"in f?Object.assign(Object.assign({},f),{logs:c}):f))});const h=yield l.done();return a&&clearTimeout(a),h}return new Promise((l,c)=>{var h;let f;const d="pollInterval"in i&&typeof i.pollInterval=="number"&&(h=i.pollInterval)!==null&&h!==void 0?h:Re,m=()=>{a&&clearTimeout(a),f&&clearTimeout(f)};o&&(a=setTimeout(()=>{m(),t.cancel(r,{requestId:s}).catch(u),c(new Error(`Client timed out waiting for the request to complete after ${o}ms`))},o));const g=()=>M(this,void 0,void 0,function*(){var _;try{const p=yield t.status(r,{requestId:s,logs:(_=i.logs)!==null&&_!==void 0?_:!1,abortSignal:i.abortSignal});if(i.onQueueUpdate&&i.onQueueUpdate(p),p.status==="COMPLETED"){m(),l(p);return}f=setTimeout(g,d)}catch(p){m(),c(p)}});g().catch(c)})})},result(r,i){return M(this,arguments,void 0,function*(s,{requestId:o,abortSignal:a}){const u=(0,X.parseEndpointId)(s),l=u.namespace?`${u.namespace}/`:"";return(0,P.dispatchRequest)({method:"get",targetUrl:(0,P.buildUrl)(`${l}${u.owner}/${u.alias}`,{subdomain:"queue",path:`/requests/${o}`}),config:Object.assign(Object.assign({},n),{responseHandler:en.resultResponseHandler}),options:{signal:a,retry:De}})})},cancel(r,i){return M(this,arguments,void 0,function*(s,{requestId:o,abortSignal:a}){const u=(0,X.parseEndpointId)(s),l=u.namespace?`${u.namespace}/`:"";yield(0,P.dispatchRequest)({method:"put",targetUrl:(0,P.buildUrl)(`${l}${u.owner}/${u.alias}`,{subdomain:"queue",path:`/requests/${o}/cancel`}),config:n,options:{signal:a}})})}};return t};re.createQueueClient=rn;var Ee={};function sn(n){const e=n.length;let t=0,r=0;for(;r<e;){let i=n.charCodeAt(r++);if(i&4294967168)if(!(i&4294965248))t+=2;else{if(i>=55296&&i<=56319&&r<e){const s=n.charCodeAt(r);(s&64512)===56320&&(++r,i=((i&1023)<<10)+(s&1023)+65536)}i&4294901760?t+=4:t+=3}else{t++;continue}}return t}function on(n,e,t){const r=n.length;let i=t,s=0;for(;s<r;){let o=n.charCodeAt(s++);if(o&4294967168)if(!(o&4294965248))e[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<r){const a=n.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}o&4294901760?(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128):(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128)}else{e[i++]=o;continue}e[i++]=o&63|128}}const an=new TextEncoder,cn=50;function ln(n,e,t){an.encodeInto(n,e.subarray(t))}function un(n,e,t){n.length>cn?ln(n,e,t):on(n,e,t)}const dn=4096;function Qe(n,e,t){let r=e;const i=r+t,s=[];let o="";for(;r<i;){const a=n[r++];if(!(a&128))s.push(a);else if((a&224)===192){const u=n[r++]&63;s.push((a&31)<<6|u)}else if((a&240)===224){const u=n[r++]&63,l=n[r++]&63;s.push((a&31)<<12|u<<6|l)}else if((a&248)===240){const u=n[r++]&63,l=n[r++]&63,c=n[r++]&63;let h=(a&7)<<18|u<<12|l<<6|c;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=dn&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const hn=new TextDecoder,fn=200;function mn(n,e,t){const r=n.subarray(e,e+t);return hn.decode(r)}function pn(n,e,t){return t>fn?mn(n,e,t):Qe(n,e,t)}class j{constructor(e,t){this.type=e,this.data=t}}class C extends Error{constructor(e){super(e);const t=Object.create(C.prototype);Object.setPrototypeOf(this,t),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:C.name})}}const z=4294967295;function gn(n,e,t){const r=t/4294967296,i=t;n.setUint32(e,r),n.setUint32(e+4,i)}function Je(n,e,t){const r=Math.floor(t/4294967296),i=t;n.setUint32(e,r),n.setUint32(e+4,i)}function Ze(n,e){const t=n.getInt32(e),r=n.getUint32(e+4);return t*4294967296+r}function yn(n,e){const t=n.getUint32(e),r=n.getUint32(e+4);return t*4294967296+r}const et=-1,_n=4294967296-1,wn=17179869184-1;function tt({sec:n,nsec:e}){if(n>=0&&e>=0&&n<=wn)if(e===0&&n<=_n){const t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,n),t}else{const t=n/4294967296,r=n&4294967295,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,e<<2|t&3),s.setUint32(4,r),i}else{const t=new Uint8Array(12),r=new DataView(t.buffer);return r.setUint32(0,e),Je(r,4,n),t}}function nt(n){const e=n.getTime(),t=Math.floor(e/1e3),r=(e-t*1e3)*1e6,i=Math.floor(r/1e9);return{sec:t+i,nsec:r-i*1e9}}function rt(n){if(n instanceof Date){const e=nt(n);return tt(e)}else return null}function it(n){const e=new DataView(n.buffer,n.byteOffset,n.byteLength);switch(n.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const t=e.getUint32(0),r=e.getUint32(4),i=(t&3)*4294967296+r,s=t>>>2;return{sec:i,nsec:s}}case 12:{const t=Ze(e,4),r=e.getUint32(0);return{sec:t,nsec:r}}default:throw new C(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${n.length}`)}}function st(n){const e=it(n);return new Date(e.sec*1e3+e.nsec/1e6)}const En={type:et,encode:rt,decode:st};class V{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(En)}register({type:e,encode:t,decode:r}){if(e>=0)this.encoders[e]=t,this.decoders[e]=r;else{const i=-1-e;this.builtInEncoders[i]=t,this.builtInDecoders[i]=r}}tryToEncode(e,t){for(let r=0;r<this.builtInEncoders.length;r++){const i=this.builtInEncoders[r];if(i!=null){const s=i(e,t);if(s!=null){const o=-1-r;return new j(o,s)}}}for(let r=0;r<this.encoders.length;r++){const i=this.encoders[r];if(i!=null){const s=i(e,t);if(s!=null){const o=r;return new j(o,s)}}}return e instanceof j?e:null}decode(e,t,r){const i=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return i?i(e,t,r):new j(t,e)}}V.defaultCodec=new V;function Sn(n){return n instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer}function pe(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):Sn(n)?new Uint8Array(n):Uint8Array.from(n)}const bn=100,xn=2048;class ie{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??V.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??bn,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??xn,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new ie({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){const t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)}resizeBuffer(e){const t=new ArrayBuffer(e),r=new Uint8Array(t),i=new DataView(t);r.set(this.bytes),this.view=i,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const r=sn(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),un(e,this.bytes,this.pos),this.pos+=r}encodeObject(e,t){const r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error(`Too large binary: ${t}`);const r=pe(e);this.writeU8a(r)}encodeArray(e,t){const r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error(`Too large array: ${r}`);for(const i of e)this.doEncode(i,t+1)}countWithoutUndefined(e,t){let r=0;for(const i of t)e[i]!==void 0&&r++;return r}encodeMap(e,t){const r=Object.keys(e);this.sortKeys&&r.sort();const i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error(`Too large map object: ${i}`);for(const s of r){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,t+1))}}encodeExtension(e){if(typeof e.data=="function"){const r=e.data(this.pos+6),i=r.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);this.writeU8(201),this.writeU32(i),this.writeI8(e.type),this.writeU8a(r);return}const t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error(`Too large extension object: ${t}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),gn(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Je(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function Cn(n,e){return new ie(e).encodeSharedRef(n)}function ue(n){return`${n<0?"-":""}0x${Math.abs(n).toString(16).padStart(2,"0")}`}const An=16,On=16;class Un{constructor(e=An,t=On){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let r=0;r<this.maxKeyLength;r++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,r){const i=this.caches[r-1];e:for(const s of i){const o=s.bytes;for(let a=0;a<r;a++)if(o[a]!==e[t+a])continue e;return s.str}return null}store(e,t){const r=this.caches[e.length-1],i={bytes:e,str:t};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=i:r.push(i)}decode(e,t,r){const i=this.find(e,t,r);if(i!=null)return this.hit++,i;this.miss++;const s=Qe(e,t,r),o=Uint8Array.prototype.slice.call(e,t,t+r);return this.store(o,s),s}}const ge="array",G="map_key",ot="map_value",Tn=n=>{if(typeof n=="string"||typeof n=="number")return n;throw new C("The type of key must be string or number but "+typeof n)};class Pn{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const t=this.getUninitializedStateFromPool();t.type=ge,t.position=0,t.size=e,t.array=new Array(e)}pushMapState(e){const t=this.getUninitializedStateFromPool();t.type=G,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===ge){const r=e;r.size=0,r.array=void 0,r.position=0,r.type=void 0}if(e.type===G||e.type===ot){const r=e;r.size=0,r.map=void 0,r.readCount=0,r.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const W=-1,Se=new DataView(new ArrayBuffer(0)),vn=new Uint8Array(Se.buffer);try{Se.getInt8(0)}catch(n){if(!(n instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Me=new RangeError("Insufficient data"),In=new Un;class D{constructor(e){this.totalPos=0,this.pos=0,this.view=Se,this.bytes=vn,this.headByte=W,this.stack=new Pn,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??V.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??z,this.maxBinLength=(e==null?void 0:e.maxBinLength)??z,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??z,this.maxMapLength=(e==null?void 0:e.maxMapLength)??z,this.maxExtLength=(e==null?void 0:e.maxExtLength)??z,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:In,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??Tn}clone(){return new D({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=W,this.stack.reset()}setBuffer(e){const t=pe(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===W&&!this.hasRemaining(1))this.setBuffer(e);else{const t=this.bytes.subarray(this.pos),r=pe(e),i=new Uint8Array(t.length+r.length);i.set(t),i.set(r,t.length),this.setBuffer(i)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:t,pos:r}=this;return new RangeError(`Extra ${t.byteLength-r} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let t=!1,r;for await(const a of e){if(t)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{r=this.doDecodeSync(),t=!0}catch(u){if(!(u instanceof RangeError))throw u}this.totalPos+=this.pos}if(t){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return r}const{headByte:i,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${ue(i)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,t){if(this.entered){yield*this.clone().decodeMultiAsync(e,t);return}try{this.entered=!0;let r=t,i=-1;for await(const s of e){if(t&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),r&&(i=this.readArraySize(),r=!1,this.complete());try{for(;yield this.doDecodeSync(),--i!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let t;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){const i=e-128;if(i!==0){this.pushMapState(i),this.complete();continue e}else t={}}else if(e<160){const i=e-144;if(i!==0){this.pushArrayState(i),this.complete();continue e}else t=[]}else{const i=e-160;t=this.decodeString(i,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)this.useBigInt64?t=this.readU64AsBigInt():t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)this.useBigInt64?t=this.readI64AsBigInt():t=this.readI64();else if(e===217){const i=this.lookU8();t=this.decodeString(i,1)}else if(e===218){const i=this.lookU16();t=this.decodeString(i,2)}else if(e===219){const i=this.lookU32();t=this.decodeString(i,4)}else if(e===220){const i=this.readU16();if(i!==0){this.pushArrayState(i),this.complete();continue e}else t=[]}else if(e===221){const i=this.readU32();if(i!==0){this.pushArrayState(i),this.complete();continue e}else t=[]}else if(e===222){const i=this.readU16();if(i!==0){this.pushMapState(i),this.complete();continue e}else t={}}else if(e===223){const i=this.readU32();if(i!==0){this.pushMapState(i),this.complete();continue e}else t={}}else if(e===196){const i=this.lookU8();t=this.decodeBinary(i,1)}else if(e===197){const i=this.lookU16();t=this.decodeBinary(i,2)}else if(e===198){const i=this.lookU32();t=this.decodeBinary(i,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){const i=this.lookU8();t=this.decodeExtension(i,1)}else if(e===200){const i=this.lookU16();t=this.decodeExtension(i,2)}else if(e===201){const i=this.lookU32();t=this.decodeExtension(i,4)}else throw new C(`Unrecognized type byte: ${ue(e)}`);this.complete();const r=this.stack;for(;r.length>0;){const i=r.top();if(i.type===ge)if(i.array[i.position]=t,i.position++,i.position===i.size)t=i.array,r.release(i);else continue e;else if(i.type===G){if(t==="__proto__")throw new C("The key __proto__ is not allowed");i.key=this.mapKeyConverter(t),i.type=ot;continue e}else if(i.map[i.key]=t,i.readCount++,i.readCount===i.size)t=i.map,r.release(i);else{i.key=null,i.type=G;continue e}}return t}}readHeadByte(){return this.headByte===W&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=W}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new C(`Unrecognized array type byte: ${ue(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new C(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new C(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){var s;if(e>this.maxStrLength)throw new C(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw Me;const r=this.pos+t;let i;return this.stateIsMapKey()&&((s=this.keyDecoder)!=null&&s.canBeCached(e))?i=this.keyDecoder.decode(this.bytes,r,e):i=pn(this.bytes,r,e),this.pos+=t+e,i}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===G:!1}decodeBinary(e,t){if(e>this.maxBinLength)throw new C(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw Me;const r=this.pos+t,i=this.bytes.subarray(r,r+e);return this.pos+=t+e,i}decodeExtension(e,t){if(e>this.maxExtLength)throw new C(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const r=this.view.getInt8(this.pos+t),i=this.decodeBinary(e,t+1);return this.extensionCodec.decode(i,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=yn(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Ze(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function Rn(n,e){return new D(e).decode(n)}function Dn(n,e){return new D(e).decodeMulti(n)}function Mn(n){return n[Symbol.asyncIterator]!=null}async function*Fn(n){const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)return;yield r}}finally{e.releaseLock()}}function be(n){return Mn(n)?n:Fn(n)}async function Ln(n,e){const t=be(n);return new D(e).decodeAsync(t)}function Nn(n,e){const t=be(n);return new D(e).decodeArrayStream(t)}function Bn(n,e){const t=be(n);return new D(e).decodeStream(t)}const kn=Object.freeze(Object.defineProperty({__proto__:null,DecodeError:C,Decoder:D,EXT_TIMESTAMP:et,Encoder:ie,ExtData:j,ExtensionCodec:V,decode:Rn,decodeArrayStream:Nn,decodeAsync:Ln,decodeMulti:Dn,decodeMultiStream:Bn,decodeTimestampExtension:st,decodeTimestampToTimeSpec:it,encode:Cn,encodeDateToTimeSpec:nt,encodeTimeSpecToTimestamp:tt,encodeTimestampExtension:rt},Symbol.toStringTag,{value:"Module"})),$n=At(kn);var T={};Object.defineProperty(T,"__esModule",{value:!0});function b(n){return{enumerable:!0,value:n}}function Fe(n){return{enumerable:!0,writable:!0,value:n}}let L={},zn=()=>!0,Le=()=>({}),at=n=>n,Wn=(n,e,t,r)=>n.apply(t,r)&&e.apply(t,r),jn=(n,e,t,[r,i])=>e.call(t,n.call(t,r,i),i),I=(n,e)=>Object.freeze(Object.create(n,e));function Ne(n,e,t){return n.reduce((r,i)=>function(...s){return t(r,i,this,s)},e)}function ct(n){return I(this,{fn:b(n)})}let lt={},ut=ct.bind(lt),Gn=n=>ut((e,t)=>!!~n(e,t)&&e),dt={},Hn=ct.bind(dt);function te(n,e){return e.filter(t=>n.isPrototypeOf(t))}function ht(n,e,...t){let r=Ne(te(dt,t).map(s=>s.fn),zn,Wn),i=Ne(te(lt,t).map(s=>s.fn),at,jn);return I(this,{from:b(n),to:b(e),guards:b(r),reducers:b(i)})}let ft={},mt={},qn=ht.bind(ft),Vn=ht.bind(mt,null);function Kn(n,e,t){return Ce(e,n,t,this.immediates)||n}function pt(n){let e=new Map;for(let t of n)e.has(t.from)||e.set(t.from,[]),e.get(t.from).push(t);return e}let Yn={enter:at};function Xn(...n){let e=te(ft,n),t=te(mt,n),r={final:b(n.length===0),transitions:b(pt(e))};return t.length&&(r.immediates=b(t),r.enter=b(Kn)),I(Yn,r)}let Qn={enter(n,e,t){let r=this.fn.call(e,e.context,t);return xe.isPrototypeOf(r)?I(gt,{machine:b(r),transitions:b(this.transitions)}).enter(n,e,t):(r.then(i=>e.send({type:"done",data:i})).catch(i=>e.send({type:"error",error:i})),n)}},gt={enter(n,e,t){if(e.child=yt(this.machine,r=>{e.onChange(r),e.child==r&&r.machine.state.value.final&&(delete e.child,e.send({type:"done",data:r.context}))},e.context,t),e.child.machine.state.value.final){let r=e.child.context;return delete e.child,Ce(e,n,{type:"done",data:r},this.transitions.get("done"))}return n}};function Jn(n,...e){let t=b(pt(e));return xe.isPrototypeOf(n)?I(gt,{machine:b(n),transitions:t}):I(Qn,{fn:b(n),transitions:t})}let xe={get state(){return{name:this.current,value:this.states[this.current]}}};function Zn(n,e,t=Le){return typeof n!="string"&&(t=e||Le,e=n,n=Object.keys(e)[0]),L._create&&L._create(n,e),I(xe,{context:b(t),current:b(n),states:b(e)})}function Ce(n,e,t,r){let{context:i}=n;for(let{to:s,guards:o,reducers:a}of r)if(o(i,t)){n.context=a.call(n,i,t);let u=e.original||e,l=I(u,{current:b(s),original:{value:u}});return L._onEnter&&L._onEnter(e,s,n.context,i,t),l.state.value.enter(l,n,t)}}function er(n,e){let t=e.type||e,{machine:r}=n,{value:i,name:s}=r.state;return i.transitions.has(t)?Ce(n,r,e,i.transitions.get(t))||r:(L._send&&L._send(t,s),r)}let tr={send(n){this.machine=er(this,n),this.onChange(this)}};function yt(n,e,t,r){let i=Object.create(tr,{machine:Fe(n),context:Fe(n.context(t,r)),onChange:b(e)});return i.send=i.send.bind(i),i.machine=i.machine.state.value.enter(i.machine,i,r),i}T.action=Gn;T.createMachine=Zn;T.d=L;T.guard=Hn;T.immediate=Vn;T.interpret=yt;T.invoke=Jn;T.reduce=ut;T.state=Xn;T.transition=qn;Object.defineProperty(Ee,"__esModule",{value:!0});Ee.createRealtimeClient=gr;const J=$n,y=T,Be=we,de=A,ke=k,Ae=x,nr=()=>({enqueuedMessage:void 0});function rr(n){return n.token!==void 0}function ir(n){return!rr(n)}function Q(n,e){return Object.assign(Object.assign({},n),{enqueuedMessage:e.message})}function v(n){return n.websocket&&n.websocket.readyState===WebSocket.OPEN&&n.websocket.close(),Object.assign(Object.assign({},n),{websocket:void 0})}function sr(n,e){return n.websocket&&n.websocket.readyState===WebSocket.OPEN?(e.message instanceof Uint8Array?n.websocket.send(e.message):n.websocket.send((0,J.encode)(e.message)),Object.assign(Object.assign({},n),{enqueuedMessage:void 0})):Object.assign(Object.assign({},n),{enqueuedMessage:e.message})}function he(n){return Object.assign(Object.assign({},n),{token:void 0})}function or(n,e){return Object.assign(Object.assign({},n),{token:e.token})}function ar(n,e){return Object.assign(Object.assign({},n),{websocket:e.websocket})}const cr=(0,y.createMachine)("idle",{idle:(0,y.state)((0,y.transition)("send","connecting",(0,y.reduce)(Q)),(0,y.transition)("expireToken","idle",(0,y.reduce)(he)),(0,y.transition)("close","idle",(0,y.reduce)(v))),connecting:(0,y.state)((0,y.transition)("connecting","connecting"),(0,y.transition)("connected","active",(0,y.reduce)(ar)),(0,y.transition)("connectionClosed","idle",(0,y.reduce)(v)),(0,y.transition)("send","connecting",(0,y.reduce)(Q)),(0,y.transition)("close","idle",(0,y.reduce)(v)),(0,y.immediate)("authRequired",(0,y.guard)(ir))),authRequired:(0,y.state)((0,y.transition)("initiateAuth","authInProgress"),(0,y.transition)("send","authRequired",(0,y.reduce)(Q)),(0,y.transition)("close","idle",(0,y.reduce)(v))),authInProgress:(0,y.state)((0,y.transition)("authenticated","connecting",(0,y.reduce)(or)),(0,y.transition)("unauthorized","idle",(0,y.reduce)(he),(0,y.reduce)(v)),(0,y.transition)("send","authInProgress",(0,y.reduce)(Q)),(0,y.transition)("close","idle",(0,y.reduce)(v))),active:(0,y.state)((0,y.transition)("send","active",(0,y.reduce)(sr)),(0,y.transition)("unauthorized","idle",(0,y.reduce)(he)),(0,y.transition)("connectionClosed","idle",(0,y.reduce)(v)),(0,y.transition)("close","idle",(0,y.reduce)(v))),failed:(0,y.state)((0,y.transition)("send","failed"),(0,y.transition)("close","idle",(0,y.reduce)(v)))},nr);function lr(n,{token:e,maxBuffering:t}){if(t!==void 0&&(t<1||t>60))throw new Error("The `maxBuffering` must be between 1 and 60 (inclusive)");const r=new URLSearchParams({fal_jwt_token:e});return t!==void 0&&r.set("max_buffering",t.toFixed(0)),`wss://fal.run/${(0,Ae.ensureEndpointIdFormat)(n)}/realtime?${r.toString()}`}const ur=128;function dr(n){return n.status==="error"&&n.error==="Unauthorized"}const hr={NORMAL_CLOSURE:1e3},fe=new Map,$e=new Map;function fr(n,e,t){if(!fe.has(n)){const r=(0,y.interpret)(cr,t);fe.set(n,Object.assign(Object.assign({},r),{throttledSend:e>0?(0,Ae.throttle)(r.send,e,!0):r.send}))}return fe.get(n)}const H=()=>{},mr={send:H,close:H};function pr(n){return n.status!=="error"&&n.type!=="x-fal-message"&&!_t(n)}function _t(n){return n.type==="x-fal-error"}function gr({config:n}){return{connect(e,t){const{clientOnly:r=(0,Ae.isReact)()&&!(0,ke.isBrowser)(),connectionKey:i=crypto.randomUUID(),maxBuffering:s,throttleInterval:o=ur}=t;if(r&&!(0,ke.isBrowser)())return mr;let a;$e.set(i,{onError:t.onError,onResult:t.onResult});const u=()=>$e.get(i),l=fr(i,o,({context:f,machine:d,send:m})=>{const{enqueuedMessage:g,token:_}=f;if(d.current==="active"&&g&&m({type:"send",message:g}),d.current==="authRequired"&&_===void 0&&a!==d.current&&(m({type:"initiateAuth"}),(0,Be.getTemporaryAuthToken)(e,n).then(p=>{m({type:"authenticated",token:p});const w=Math.round(Be.TOKEN_EXPIRATION_SECONDS*.9*1e3);setTimeout(()=>{m({type:"expireToken"})},w)}).catch(p=>{m({type:"unauthorized",error:p})})),d.current==="connecting"&&a!==d.current&&_!==void 0){const p=new WebSocket(lr(e,{token:_,maxBuffering:s}));p.onopen=()=>{m({type:"connected",websocket:p})},p.onclose=w=>{if(w.code!==hr.NORMAL_CLOSURE){const{onError:O=H}=u();O(new de.ApiError({message:`Error closing the connection: ${w.reason}`,status:w.code}))}m({type:"connectionClosed",code:w.code})},p.onerror=w=>{const{onError:O=H}=u();O(new de.ApiError({message:"Unknown error",status:500}))},p.onmessage=w=>{const{onResult:O}=u();if(w.data instanceof ArrayBuffer){const U=(0,J.decode)(new Uint8Array(w.data));O(U);return}if(w.data instanceof Uint8Array){const U=(0,J.decode)(w.data);O(U);return}if(w.data instanceof Blob){w.data.arrayBuffer().then(U=>{const oe=(0,J.decode)(new Uint8Array(U));O(oe)});return}const S=JSON.parse(w.data);if(dr(S)){m({type:"unauthorized",error:new Error("Unauthorized")});return}if(pr(S)){O(S);return}if(_t(S)){if(S.error==="TIMEOUT")return;const{onError:U=H}=u();U(new de.ApiError({message:`${S.error}: ${S.reason}`,status:400,body:S}));return}}}a=d.current});return{send:f=>{l.throttledSend({type:"send",message:f})},close:()=>{l.send({type:"close"})}}}}}var Oe={},F=E&&E.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(h){o(h)}}function u(c){try{l(r.throw(c))}catch(h){o(h)}}function l(c){c.done?s(c.value):i(c.value).then(a,u)}l((r=r.apply(n,e||[])).next())})};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.createStorageClient=Sr;const wt=ne,Et=R,yr=x;function St(n){var e;const[t,r]=n.split("/");return(e=r.split(/[-;]/)[0])!==null&&e!==void 0?e:"bin"}function _r(n,e,t){return F(this,void 0,void 0,function*(){const r=n.name||`${Date.now()}.${St(t)}`;return yield(0,Et.dispatchRequest)({method:"POST",targetUrl:`${(0,wt.getRestApiUrl)()}/storage/upload/initiate?storage_type=fal-cdn-v3`,input:{content_type:t,file_name:r},config:e})})}function wr(n,e,t){return F(this,void 0,void 0,function*(){const r=n.name||`${Date.now()}.${St(t)}`;return yield(0,Et.dispatchRequest)({method:"POST",targetUrl:`${(0,wt.getRestApiUrl)()}/storage/upload/initiate-multipart?storage_type=fal-cdn-v3`,input:{content_type:t,file_name:r},config:e})})}function bt(n,e,t){return F(this,arguments,void 0,function*(r,i,s,o=3){if(o===0)throw new Error("Part upload failed, retries exhausted");const{fetch:a,responseHandler:u}=s;try{const l=yield a(r,{method:"PUT",body:i});return yield u(l)}catch{return yield bt(r,i,s,o-1)}})}function Er(n,e){return F(this,void 0,void 0,function*(){const{fetch:t,responseHandler:r}=e,i=n.type||"application/octet-stream",{upload_url:s,file_url:o}=yield wr(n,e,i),a=10*1024*1024,u=Math.ceil(n.size/a),l=new URL(s),c=[];for(let d=0;d<u;d++){const m=d*a,g=Math.min(m+a,n.size),_=n.slice(m,g),p=d+1,w=`${l.origin}${l.pathname}/${p}${l.search}`;c.push(yield bt(w,_,e))}const h=`${l.origin}${l.pathname}/complete${l.search}`,f=yield t(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parts:c.map(d=>({partNumber:d.partNumber,etag:d.etag}))})});return yield r(f),o})}function Sr({config:n}){const e={upload:t=>F(this,void 0,void 0,function*(){if(t.size>94371840)return yield Er(t,n);const r=t.type||"application/octet-stream",{fetch:i,responseHandler:s}=n,{upload_url:o,file_url:a}=yield _r(t,n,r),u=yield i(o,{method:"PUT",body:t,headers:{"Content-Type":t.type||"application/octet-stream"}});return yield s(u),a}),transformInput:t=>F(this,void 0,void 0,function*(){if(Array.isArray(t))return Promise.all(t.map(r=>e.transformInput(r)));if(t instanceof Blob)return yield e.upload(t);if((0,yr.isPlainObject)(t)){const i=Object.entries(t).map(o=>F(this,[o],void 0,function*([a,u]){return[a,yield e.transformInput(u)]})),s=yield Promise.all(i);return Object.fromEntries(s)}return t})};return e}var ze=E&&E.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(h){o(h)}}function u(c){try{l(r.throw(c))}catch(h){o(h)}}function l(c){c.done?s(c.value):i(c.value).then(a,u)}l((r=r.apply(n,e||[])).next())})};Object.defineProperty(Z,"__esModule",{value:!0});Z.createFalClient=Tr;const br=ne,xr=re,Cr=Ee,We=R,Ar=A,Or=Oe,Ur=$;function Tr(n={}){const e=(0,br.createConfig)(n),t=(0,Or.createStorageClient)({config:e}),r=(0,xr.createQueueClient)({config:e,storage:t}),i=(0,Ur.createStreamingClient)({config:e,storage:t}),s=(0,Cr.createRealtimeClient)({config:e});return{queue:r,realtime:s,storage:t,streaming:i,stream:i.stream,run(o){return ze(this,arguments,void 0,function*(a,u={}){const l=u.input?yield t.transformInput(u.input):void 0;return(0,We.dispatchRequest)({method:u.method,targetUrl:(0,We.buildUrl)(a,u),input:l,config:Object.assign(Object.assign({},e),{responseHandler:Ar.resultResponseHandler}),options:{signal:u.abortSignal,retry:{maxRetries:3,baseDelay:500,maxDelay:15e3}}})})},subscribe:(o,a)=>ze(this,void 0,void 0,function*(){const{request_id:u}=yield r.submit(o,a);return a.onEnqueue&&a.onEnqueue(u),yield r.subscribeToStatus(o,Object.assign({requestId:u},a)),r.result(o,{requestId:u})})}}var se={};Object.defineProperty(se,"__esModule",{value:!0});se.isQueueStatus=xt;se.isCompletedQueueStatus=Pr;function xt(n){return n&&n.status&&n.response_url}function Pr(n){return xt(n)&&n.status==="COMPLETED"}(function(n){var e=E&&E.__createBinding||(Object.create?function(l,c,h,f){f===void 0&&(f=h);var d=Object.getOwnPropertyDescriptor(c,h);(!d||("get"in d?!c.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return c[h]}}),Object.defineProperty(l,f,d)}:function(l,c,h,f){f===void 0&&(f=h),l[f]=c[h]}),t=E&&E.__exportStar||function(l,c){for(var h in l)h!=="default"&&!Object.prototype.hasOwnProperty.call(c,h)&&e(c,l,h)};Object.defineProperty(n,"__esModule",{value:!0}),n.fal=n.parseEndpointId=n.isRetryableError=n.ValidationError=n.ApiError=n.withProxy=n.withMiddleware=n.createFalClient=void 0;const r=Z;var i=Z;Object.defineProperty(n,"createFalClient",{enumerable:!0,get:function(){return i.createFalClient}});var s=ye;Object.defineProperty(n,"withMiddleware",{enumerable:!0,get:function(){return s.withMiddleware}}),Object.defineProperty(n,"withProxy",{enumerable:!0,get:function(){return s.withProxy}});var o=A;Object.defineProperty(n,"ApiError",{enumerable:!0,get:function(){return o.ApiError}}),Object.defineProperty(n,"ValidationError",{enumerable:!0,get:function(){return o.ValidationError}});var a=K;Object.defineProperty(n,"isRetryableError",{enumerable:!0,get:function(){return a.isRetryableError}}),t(se,n);var u=x;Object.defineProperty(n,"parseEndpointId",{enumerable:!0,get:function(){return u.parseEndpointId}}),n.fal=function(){let c=(0,r.createFalClient)();return{config(h){c=(0,r.createFalClient)(h)},get queue(){return c.queue},get realtime(){return c.realtime},get storage(){return c.storage},get streaming(){return c.streaming},run(h,f){return c.run(h,f)},subscribe(h,f){return c.subscribe(h,f)},stream(h,f){return c.stream(h,f)}}}()})(je);const Dr=Ot({__proto__:null},[je]);export{Dr as i};
